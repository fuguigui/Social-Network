---
title: "Network Analysis - Homework 3"
output: pdf_document
---
```{r}
rm(list=ls())
```

```{r}
library(igraph)

setwd("E:/courses/Network analysis/lab/lab5")
exports <- data.matrix(read.csv("./data/exports.csv", header = T, sep=",", row.names=1, stringsAsFactors=F))
countries <- read.csv("./data/countries.csv", header = T, sep=",",  row.names=1)
```

```{r}
colnames(countries)
```

```{r}
exports[is.na(exports)] <- 0
exports.graph <- graph.adjacency(exports, mode='directed', weighted=TRUE)
exports.graph
```

```{r}
E(exports.graph)
```


```{r}
CorenessLayout <- function(g) {
coreness <- graph.coreness(g);
xy <- array(NA, dim=c(length(coreness), 2));
 
shells <- sort(unique(coreness));
for(shell in shells) {
v <- 1 - ((shell-1) / max(shells));
nodes_in_shell <- sum(coreness==shell);
angles <- seq(0,360,(360/nodes_in_shell));
angles <- angles[-length(angles)]; # remove last element
xy[coreness==shell, 1] <- sin(angles) * v;
xy[coreness==shell, 2] <- cos(angles) * v;
}
return(xy);
}

```



Separating the countries in 5 groups of equal size in terms of gdp and stregth of exports (number of exports weighted by the amount of exports), we get groups of 34 to 35 countries. We add as these as attributes of of the network.
```{r}
library(dplyr)
library(GGally)

countries$gdp_bin<- ggplot2::cut_number(countries$gdp,5, labels=c("1", "2", "3", "4", "5"))
countries$exports_strength<-  igraph::strength(exports.graph) %>% ggplot2::cut_number(10, labels=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))
```

```{r}
# Plot with gdp and export strength
ggnet2(exports.graph, 
       color = "phono",
       mode = "kamadakawai",
       node.size = countries$exports_strength, 
       node.color = countries$gdp_bin, 
       edge.size = 0.02
      )
```
Plotting the network, with node colour depending on gdp and node size depending on export strength, we can laready observe that countries with high gdp export the most (in terms of strength). The 35 countries with the highest gdp are also at the center of the network, plotted using kamadakawai layout, which suggests they form the core of the network, while the 35 countries with the lowest gdp tend to be at the periphery of the network.


```{r}
countries$coreness <- graph.coreness(exports.graph, mode='out')
table(countries$coreness)
```
Looking at the table, we can see that computing the coreness is not very informative, since 92 of the contries have a coreness of 73, meaning that 93 countries are in a maximal subgraph in which every vertex has at least degree 73.

```{r}
#Plot with coreness
ggnet2(exports.graph, 
       color = "phono",
       mode = "kamadakawai",
       #mode=ll,
       size = countries$coreness, 
       size.cut = 10,
       node.color = countries$gdp_bin, 
       edge.size = 0.02,
       label=NaN
      )
```
Again, countries with the highest GDP seem to be part of the largest k-kcore subgraph.

```{r}
# Where is the biggest clique?
require(RColorBrewer)
export_clique <- largest.cliques(exports.graph)

dev.new(width=10, height=8)
plot(exports.graph, mark.groups = largest.cliques(exports.graph)[1], 
     layout.fruchterman.reingold(exports.graph),    
     main='Clique 1',
     vertex.size= 6, 
     vertex.color=countries$gdp_bin, 
     edge.width =0.1,
     edge.arrow.size=0.01,
     edge.arrow.width=E(exports.graph)$size,
     vertex.label=NA)
```

```{r}
dev.new(width=10, height=8)
plot(exports.graph, mark.groups = largest.cliques(exports.graph)[2], 
     layout.fruchterman.reingold(exports.graph),    
     main='Clique 2',
     vertex.size= 6, 
     vertex.color=countries$gdp_bin, 
     edge.width =0.1,
     edge.arrow.size=0.01,
     edge.arrow.width=E(exports.graph)$size,
     vertex.label=NA)
```

```{r}
dev.new(width=10, height=8)
plot(exports.graph, mark.groups = largest.cliques(exports.graph)[3], 
     layout.fruchterman.reingold(exports.graph),    
     main='CLique 3',
     vertex.size= 5, 
     vertex.color=countries$gdp_bin, 
     edge.width =0.1,
     edge.arrow.size=0.01,
     edge.arrow.width=E(exports.graph)$size,
     vertex.label=NA)
```

Plotting the first 3 cliques out of 8, we see that we usually have the same countries (in particular the countries in yellow, with the highest GDP, and at the center of the network) part of a clique. 


